"""Provides EmitterBase."""
from abc import ABC, abstractmethod

import numpy as np


class EmitterBase(ABC):
    """Base class for emitters.

    Every emitter has an :meth:`ask` method that generates a batch of solutions,
    and a :meth:`tell` method that inserts solutions into the emitter's archive.
    Users are only required to override :meth:`ask`.

    .. note:: Members beginning with an underscore are only intended to be
        accessed by child classes.

    Args:
        solution_dim (int): The dimension of solutions produced by this emitter.
        batch_size (int): Number of solutions to generate on each call to
            :meth:`ask`.
        archive (ribs.archives.ArchiveBase): An archive to use when creating and
            inserting solutions. For instance, this can be
            :class:`ribs.archives.GridArchive`.
        seed (float or int): Seed for the random number generator. None
            (default) means no seed.
    Attributes:
        _rng (np.random.Generator): Random number generator.
        _archive (ribs.archives.ArchiveBase): See ``archive`` arg.
    """

    def __init__(self, solution_dim, batch_size, archive, seed=None):
        self._rng = np.random.default_rng(seed)
        self._archive = archive
        self._solution_dim = solution_dim
        self._batch_size = batch_size

    @property
    def solution_dim(self):
        """int: The dimension of solutions produced by this emitter."""
        return self._solution_dim

    @property
    def batch_size(self):
        """int: Number of solutions to generate on each call to :meth:`ask`."""
        return self._batch_size

    @abstractmethod
    def ask(self):
        """Generates ``self.batch_size`` solutions."""

    def tell(self, solutions, objective_values, behavior_values):
        """Gives the emitter results from evaluating several solutions.

        These solutions are then inserted into the archive.

        Args:
            solutions (np.ndarray): Array of solutions generated by this
                emitter's :meth:`ask()` method.
            objective_values (np.ndarray): 1D array containing the objective
                function value of each solution.
            behavior_values (np.ndarray): ``(n, <behavior space dimension>)``
                array with the behavior space coordinates of each solution.
        """
        for sol, obj, beh in zip(solutions, objective_values, behavior_values):
            self._archive.add(sol, obj, beh)
